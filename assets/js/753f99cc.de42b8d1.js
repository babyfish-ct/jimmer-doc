"use strict";(self.webpackChunkdocusaurus_code=self.webpackChunkdocusaurus_code||[]).push([[1220],{88782:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"query/object-fetcher/dto","title":"Querying DTOs","description":"Previously we introduced using object fetchers to flexibly control the shape of queried data structures.","source":"@site/docs/query/object-fetcher/dto.mdx","sourceDirName":"query/object-fetcher","slug":"/query/object-fetcher/dto","permalink":"/jimmer-doc/docs/query/object-fetcher/dto","draft":false,"unlisted":false,"editUrl":"https://github.com/babyfish-ct/jimmer-doc/edit/main/docs/query/object-fetcher/dto.mdx","tags":[],"version":"current","lastUpdatedAt":1742063236000,"sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"Querying DTOs"},"sidebar":"tutorialSidebar","previous":{"title":"View Properties","permalink":"/jimmer-doc/docs/query/object-fetcher/view"},"next":{"title":"Working with Spring Data","permalink":"/jimmer-doc/docs/query/object-fetcher/spring-data"}}');var r=t(74848),a=t(28453),o=t(11470),s=t(19365);const l={sidebar_position:6,title:"Querying DTOs"},c=void 0,d={},h=[{value:"Defining DTO Shapes",id:"defining-dto-shapes",level:2},{value:"Auto-generated DTO Types",id:"auto-generated-dto-types",level:2},{value:"Querying DTO Objects",id:"querying-dto-objects",level:2},{value:"Using findById",id:"using-findbyid",level:3},{value:"Using Custom Queries",id:"using-custom-queries",level:3},{value:"Association Property Specific Configurations",id:"association-property-specific-configurations",level:2},{value:"BatchSize",id:"batchsize",level:3},{value:"Association-level Pagination",id:"association-level-pagination",level:3},{value:"Property Filters",id:"property-filters",level:3},{value:"Reference Fetching Methods",id:"reference-fetching-methods",level:3},{value:"Limit recursion depth",id:"limit-recursion-depth",level:3},{value:"Controlling Whether Each Node is Recursive",id:"controlling-whether-each-node-is-recursive",level:3}];function u(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Previously we introduced using object fetchers to flexibly control the shape of queried data structures."}),"\n",(0,r.jsx)(n.p,{children:"Now we introduce an equivalent capability: querying DTO objects."}),"\n",(0,r.jsxs)(n.p,{children:["Jimmer provides a ",(0,r.jsx)(n.a,{href:"../../object/view/dto-language",children:"DTO language"})]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"This language is essentially another way to express object fetchers."})}),"\n",(0,r.jsx)(n.p,{children:"Using this language, developers can quickly define various data structure shapes with an entity type as the aggregate root. The compiler will generate corresponding Java/Kotlin DTO classes for each defined shape. Each DTO type contains mutual conversion logic with the original dynamic type, and an object fetcher matching its own shape."}),"\n",(0,r.jsx)(n.p,{children:"In some cases, after the server queries data in a certain shape, it is not meant to be returned as an HTTP response, but rather used internally to drive subsequent complex business logic. This is an ideal scenario for this approach."}),"\n",(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsxs)(n.p,{children:["Note that if the server queries data in a certain shape not for its own use, but directly as the HTTP response, it is more recommended to directly return the dynamic entity object and use the solutions in ",(0,r.jsx)(n.a,{href:"../../client",children:"Generate Client Code"})," to automatically generate client code with a great developer experience."]})}),"\n",(0,r.jsx)(n.h2,{id:"defining-dto-shapes",children:"Defining DTO Shapes"}),"\n",(0,r.jsxs)(n.p,{children:["This article focuses on explaining how to query static DTO types, not a systematic introduction to the DTO language itself. Please refer to ",(0,r.jsx)(n.a,{href:"../../object/view/dto-language",children:"Object section/DTO Mapping/DTO Language"})," for the complete DTO language."]}),"\n",(0,r.jsxs)(n.p,{children:["Assuming the fully qualified name of the ",(0,r.jsx)(n.code,{children:"Book"})," class is ",(0,r.jsx)(n.code,{children:"com.yourcompany.yourproject.model.Book"}),", you can"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"In the project where the entity is defined"}),", create the directory ",(0,r.jsx)(n.code,{children:"src/main/dto"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Under ",(0,r.jsx)(n.code,{children:"src/main/dto"}),", create a file ",(0,r.jsx)(n.code,{children:"Book.dto"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Edit this file, use the DTO language to define various DTO shapes for the Book entity"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:'title="Book.dto" ',children:"export com.yourcompany.yourproject.model.Book \n    -> package com.yourcompany.yourproject.model.dto\n\n// highlight-next-line\nBookDetailView {\n    \n    #allScalars\n    \n    store {\n        #allScalars\n    }\n\n    authors {\n        #allScalars\n    }\n}\n\nSimpleBookView { ...omitted... }\n\n...Omit definitions of other DTO shapes...\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"auto-generated-dto-types",children:"Auto-generated DTO Types"}),"\n",(0,r.jsx)(n.p,{children:"Jimmer is responsible for compiling dto files and automatically generating DTO types matching these shapes."}),"\n",(0,r.jsxs)(n.admonition,{type:"caution",children:[(0,r.jsx)(n.p,{children:"If Java/Kotlin source code files other than dto files are modified, running the application directly from the IDE can trigger recompilation of dto files."}),(0,r.jsx)(n.p,{children:"However, if no Java/Kotlin files other than dto files are modified, simply clicking the run button in the IDE does not cause dto files to be recompiled unless explicitly rebuilding!"}),(0,r.jsxs)(n.p,{children:["If you are using Gradle as your build tool, you can also use the third-party Gradle plugin provided by the community to solve this problem: ",(0,r.jsx)(n.a,{href:"https://github.com/Enaium/jimmer-gradle",children:"jimmer-gradle"})]})]}),"\n",(0,r.jsxs)(n.p,{children:["Taking ",(0,r.jsx)(n.code,{children:"BookDetailView"})," in the above code as an example, after the dto file is successfully compiled by Jimmer, the following DTO type will be automatically generated:"]}),"\n",(0,r.jsxs)(o.A,{groupId:"language",children:[(0,r.jsx)(s.A,{value:"java",label:"Java",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="BookDetailView.java"',children:'package com.yourcompany.yourproject.model.dto;\n\nimport com.yourcompany.yourproject.model.Book;\nimport org.babyfish.jimmer.View;\n\n@GeneratedBy(file = "<your_project>/src/main/dto/Book.dto")\npublic class BookDetailView implements View<Book> {\n\n    private long id;\n\n    private String name;\n\n    private int edition;\n\n    private BigDecimal price;\n\n    // highlight-next-line\n    private TargetOf_store store;\n\n    // highlight-next-line\n    private List<TargetOf_authors> authors;\n\n    // highlight-next-line\n    public static class TargetOf_store implements View<BookStore> {\n\n        private long id;\n    \n        private String name;\n\n        @Nullable\n        private String website;\n\n        ...other members omitted...\n    }\n\n    // highlight-next-line\n    public static class TargetOf_authors implements View<Author> {\n\n        private long id;\n        \n        private String firstName;\n\n        private String lastName;\n\n        private Gender gender;\n\n        ...other members omitted...\n    }\n\n    ...other members omitted...\n}\n'})})}),(0,r.jsx)(s.A,{value:"kotlin",label:"Kotlin",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kotlin",metastring:'title="BookDetailView.kt"',children:'package com.yourcompany.yourproject.model.dto\n\nimport com.yourcompany.yourproject.model.Book\nimport org.babyfish.jimmer.View\n\n@GeneratedBy(file = "<your_project>/src/main/dto/Book.dto")\ndata class BookDetailView(\n    val id: Long = 0,\n    val name: String = "",\n    val edition: Int = 0,\n    val price: BigDecimal,\n\n    // highlight-next-line\n    val store: TargetOf_store? = null,\n    // highlight-next-line\n    val authors: List<TargetOf_authors> = emptyList(),\n) : View<Book> {\n\n    // highlight-next-line\n    data class TargetOf_store(\n        val id: Long = 0,\n        val name: String = "",\n        val website: String? = null,\n    ) : View<BookStore> {\n        ...other members omitted...\n    }\n\n    // highlight-next-line\n    data class TargetOf_authors(\n        val id: Long = 0,\n        public val firstName: String = "",\n        public val lastName: String = "",\n        public val gender: Gender,\n    ) : View<Author> {\n        ...other members omitted...\n    }\n\n    ...other members omitted...\n} \n'})})})]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["The generated DTO classes are in the ",(0,r.jsx)(n.code,{children:"dto"})," subpackage of the entity package, not the entity package itself."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"For Java, it is assumed lombok is already in use."}),"\n"]}),"\n"]})}),"\n",(0,r.jsx)(n.h2,{id:"querying-dto-objects",children:"Querying DTO Objects"}),"\n",(0,r.jsx)(n.h3,{id:"using-findbyid",children:"Using findById"}),"\n",(0,r.jsxs)(o.A,{groupId:"language",children:[(0,r.jsx)(s.A,{value:"java",label:"Java",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"BookDetailView view = sqlClient.findNullable(\n    // highlight-next-line\n    BookDetailView.class, \n    1L\n);\nSystem.out.println(view);\n"})})}),(0,r.jsx)(s.A,{value:"kotlin",label:"Kotlin",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kotlin",children:"val view = sqlClient.findNullable(\n    // highlight-next-line\n    BookDetailView::class, \n    1L\n);\nprintln(view)\n"})})})]}),"\n",(0,r.jsxs)(n.p,{children:["The printed result is as follows ",(0,r.jsx)(n.em,{children:"(formatted manually for readability)"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// highlight-next-line  \nBookDetailView(\n    id=1,\n    name=Learning GraphQL,\n    edition=1,\n    price=50.00,\n    // highlight-next-line\n    store=BookDetailView.TargetOf_store(\n        id=1,\n        name=O'REILLY,\n        website=null,\n        version=0\n    ),\n    authors=[\n        // highlight-next-line\n        BookDetailView.TargetOf_authors(\n            id=2,\n            firstName=Alex,\n            lastName=Banks,\n            gender=MALE  \n        ),\n        // highlight-next-line \n        BookDetailView.TargetOf_authors(\n            id=1,\n            firstName=Eve,\n            lastName=Procello,\n            gender=FEMALE\n        )\n    ]\n)\n"})}),"\n",(0,r.jsx)(n.p,{children:"It's easy to see that although dynamic entity objects are no longer returned, the functionality is exactly the same as object fetchers. Why is this?"}),"\n",(0,r.jsx)(n.p,{children:"The DTO types generated from the DTO language all contain object fetchers matching their own shapes, as follows:"}),"\n",(0,r.jsxs)(o.A,{groupId:"language",children:[(0,r.jsx)(s.A,{value:"java",label:"Java",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="BookDetailView.java" ',children:"@Data\npublic class BookDetailView implements View<Book> {\n\n    public static final ViewMetadata<Book, BookDetailView> METADATA =  \n        new ViewMetadata<Book, BookDetailView>(\n            // highlight-start     \n            Fetchers.BOOK_FETCHER\n                .name()\n                .edition()\n                .price()\n                .store(TargetOf_store.METADATA.getFetcher())\n                .authors(TargetOf_authors.METADATA.getFetcher()),\n            // highlight-end\n            BookDetailView::new\n    );\n\n    @Data\n    public static class TargetOf_store implements View<BookStore> {\n\n        public static final ViewMetadata<BookStore, TargetOf_store> METADATA =  \n            new ViewMetadata<BookStore, TargetOf_store>(\n                // highlight-start\n                Fetchers.BOOK_STORE_FETCHER\n                    .name()\n                    .website()\n                    .version(),\n                // highlight-end\n                TargetOf_store::new\n        );\n\n        ...other members omitted...\n    }\n\n    @Data\n    public static class TargetOf_authors implements View<Author> {\n\n        public static final ViewMetadata<Author, TargetOf_authors> METADATA =\n            new ViewMetadata<Author, TargetOf_authors>(\n                // highlight-start\n                Fetchers.AUTHOR_FETCHER\n                    .firstName()\n                    .lastName()\n                    .gender(),\n                // highlight-end\n                TargetOf_authors::new\n        );\n\n        ...other members omitted...\n    }\n\n    ...other members omitted...\n}\n"})})}),(0,r.jsx)(s.A,{value:"kotlin",label:"Kotlin",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kotlin",metastring:'title="BookDetailView.kt"',children:"@Data  \ndata class BookDetailView(\n    ...omitted...\n) : View<Book> {\n\n    ...other members omitted...\n\n    companion object {\n        @JvmStatic\n        public val METADATA: ViewMetadata<Book, BookDetailView> =  \n            ViewMetadata<Book, CompositeBookInput>(\n                // highlight-start\n                newFetcher(Book::class).by {\n                    name()\n                    edition()\n                    price()\n                    store(TargetOf_store.METADATA.fetcher) \n                    authors(TargetOf_authors.METADATA.fetcher)\n                }\n                // highlight-end\n            ) {\n                CompositeBookInput(it)\n            }\n\n    }\n\n    @Data\n    public static class TargetOf_store implements View<BookStore> {\n\n        ...other members omitted...\n\n        companion object {\n\n            @JvmStatic\n            val METADATA: ViewMetadata<BookStore, TargetOf_store> =  \n                ViewMetadata<BookStore, TargetOf_store>(\n                    // highlight-start\n                    newFetcher(BookStore::class).by {\n                        name()\n                        website()\n                    }\n                    // highlight-end\n                ) {\n                    TargetOf_store(it)\n                }\n\n        }\n    }\n\n    @Data\n    public static class TargetOf_authors implements View<Author> {\n\n        ...other members omitted...\n\n        companion object {\n\n            @JvmStatic\n            val METADATA: ViewMetadata<Author, TargetOf_authors> =\n                ViewMetadata<Author, TargetOf_authors>(\n                    // highlight-start  \n                    newFetcher(Author::class).by {\n                        firstName()\n                        lastName()\n                        gender()\n                    }\n                    // highlight-end\n                ) {\n                    TargetOf_authors(it)\n                }\n        }   \n    }\n}\n"})})})]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"This is why this article says at the beginning that the DTO language is essentially another way to express object fetchers."})}),"\n",(0,r.jsx)(n.h3,{id:"using-custom-queries",children:"Using Custom Queries"}),"\n",(0,r.jsxs)(o.A,{groupId:"language",children:[(0,r.jsx)(s.A,{value:"java",label:"Java",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'BookTable table = Tables.BOOK_TABLE;\n\nList<Book> books = sqlClient  \n    .createQuery(table)\n    .where(table.name().eq("GraphQL in Action"))\n    .orderBy(table.name())\n    .orderBy(table.edition().desc())\n    .select(\n        // highlight-next-line\n        table.fetch(BookDetailView.class)  \n    )  \n    .execute()\n'})})}),(0,r.jsx)(s.A,{value:"kotlin",label:"Kotlin",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kotlin",children:'val books = sqlClient  \n    .createQuery(Book::class) {\n        where(table.name eq "GraphQL in Action")\n        orderBy(table.name)\n        orderBy(table.edition.desc())\n        select(\n            // highlight-next-line\n            table.fetch(BookDetailView::class)\n        )\n    }\n    .execute()\n'})})})]}),"\n",(0,r.jsxs)(n.p,{children:["Here we see that ",(0,r.jsx)(n.code,{children:"table.fetch(fetcher)"})," in previous code is replaced with ",(0,r.jsx)(n.code,{children:"table.fetch(BookDetailView.class)"}),"."]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["All low-level query APIs can replace ",(0,r.jsx)(n.code,{children:"fetcher"})," with ",(0,r.jsx)(n.code,{children:"viewType"}),", again proving that the DTO language is essentially another way to express object fetchers, as stated at the beginning."]})}),"\n",(0,r.jsx)(n.h2,{id:"association-property-specific-configurations",children:"Association Property Specific Configurations"}),"\n",(0,r.jsxs)(n.admonition,{type:"note",children:[(0,r.jsx)(n.p,{children:"Jimmer DTOs are divided into three types:"}),(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Output DTO"}),"\n",(0,r.jsx)(n.li,{children:"Input DTO"}),"\n",(0,r.jsx)(n.li,{children:"Specification DTO"}),"\n"]}),(0,r.jsx)(n.p,{children:"The DTOs discussed in this article are used to define object fetchers and map their query results to static objects, which belong to the Output DTO category."}),(0,r.jsx)(n.p,{children:"Therefore, the configurations introduced in this section are specific to Output DTOs."})]}),"\n",(0,r.jsxs)(n.p,{children:["In ",(0,r.jsx)(n.a,{href:"./association",children:"Object Fetcher/Association Properties"}),", we introduced some specific configurations for association properties:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"BatchSize"}),"\n",(0,r.jsx)(n.li,{children:"Association-level pagination"}),"\n",(0,r.jsx)(n.li,{children:"Property filters"}),"\n",(0,r.jsx)(n.li,{children:"Reference fetching methods"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["In ",(0,r.jsx)(n.a,{href:"./recursive",children:"Object Fetcher/Recursive Queries"}),", we introduced:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Limit recursion depth"}),"\n",(0,r.jsx)(n.li,{children:"Controlling whether each node is recursive"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Similarly, as a more type-oriented representation of type fetchers, Output DTOs also have these configurations."}),"\n",(0,r.jsx)(n.h3,{id:"batchsize",children:"BatchSize"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:'title="Book.dto"',children:"export com.yourcompany.yourproject.model.Book \n    -> package com.yourcompany.yourproject.model.dto\n\nBookDetailView {\n\n    #allScalars\n\n    // highlight-next-line\n    !batch(2)\n    authors {\n        #allScalars\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"association-level-pagination",children:"Association-level Pagination"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:'title="Book.dto"',children:"export com.yourcompany.yourproject.model.Book \n    -> package com.yourcompany.yourproject.model.dto\n\nBookDetailView {\n\n    #allScalars\n\n    // highlight-next-line\n    !limit(10, 90) // limit: 10, offset: 90\n    authors {\n        #allScalars\n    }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Or"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:'title="Book.dto"',children:"export com.yourcompany.yourproject.model.Book \n    -> package com.yourcompany.yourproject.model.dto\n\nBookDetailView {\n\n    #allScalars\n\n    // highlight-next-line\n    !limit(10) // limit: 10, offset: 0\n    authors {\n        #allScalars\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"property-filters",children:"Property Filters"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:'title="Book.dto"',children:"export com.yourcompany.yourproject.model.Book \n    -> package com.yourcompany.yourproject.model.dto\n\nBookDetailView {\n\n    #allScalars\n\n    // highlight-start\n    !where(firstName ilike '%a%' or lastName ilike '%a%')\n    !orderBy(firstName asc, lastName asc)\n    // highlight-end\n    authors {\n        #allScalars\n    }\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["To limit the complexity of the DTO language, ",(0,r.jsx)(n.code,{children:"!where"})," and ",(0,r.jsx)(n.code,{children:"!orderBy"})," intentionally restrict the syntax complexity. Taking the conditional expressions in ",(0,r.jsx)(n.code,{children:"!where"})," as an example:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Supports ",(0,r.jsx)(n.code,{children:"and"})," and ",(0,r.jsx)(n.code,{children:"or"}),", as well as changing operator precedence through ",(0,r.jsx)(n.code,{children:"()"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Variables must be properties in the associated entity ",(0,r.jsxs)(n.em,{children:["(in this example, ",(0,r.jsx)(n.code,{children:"Author"}),")"]})," that can be mapped to database columns, i.e., scalar properties and association IDs.","\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["If the property is a ",(0,r.jsx)(n.a,{href:"../../mapping/advanced/embedded",children:"composite field"}),", you can use the ",(0,r.jsx)(n.code,{children:"."})," chain to reference internal properties, such as ",(0,r.jsx)(n.code,{children:"fullName.firstName"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Supports binary operators ",(0,r.jsx)(n.code,{children:"="}),", ",(0,r.jsx)(n.code,{children:"<>"}),", ",(0,r.jsx)(n.code,{children:"!="}),", ",(0,r.jsx)(n.code,{children:"<"}),", ",(0,r.jsx)(n.code,{children:"<="}),", ",(0,r.jsx)(n.code,{children:">"}),", ",(0,r.jsx)(n.code,{children:">="}),", ",(0,r.jsx)(n.code,{children:"like"}),", and ",(0,r.jsx)(n.code,{children:"ilike"}),", where ",(0,r.jsx)(n.code,{children:"<>"})," and ",(0,r.jsx)(n.code,{children:"!="})," are equivalent."]}),"\n",(0,r.jsxs)(n.li,{children:["Supports unary operators ",(0,r.jsx)(n.code,{children:"is null"})," and ",(0,r.jsx)(n.code,{children:"is not null"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Obviously, the design purpose is to control the complexity of the DTO language. If you need to write arbitrarily complex filtering and sorting, please use ",(0,r.jsx)(n.code,{children:"!filter"})," as follows:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"First, create a new class."}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["For Java, implement the ",(0,r.jsx)(n.code,{children:"org.babyfish.jimmer.sql.fetcher.FieldFilter<T>"})," interface"]}),"\n",(0,r.jsxs)(n.li,{children:["For Kotlin, implement the ",(0,r.jsx)(n.code,{children:"org.babyfish.jimmer.sql.kt.fetcher.KFieldFilter<E>"})," interface"]}),"\n"]}),"\n",(0,r.jsxs)(o.A,{groupId:"language",children:[(0,r.jsx)(s.A,{value:"java",label:"Java",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="AuthorFilter.java"',children:'package com.yourcompany.yourpackage.strategy;\n\n...omitted import statements...\n\npublic class AuthorsPropFilter implements FieldFilter<AuthorTable> {\n\n    @Override\n    public void apply(FieldFilterArgs<AuthorTable> args) {\n        AuthorTable table = args.getTable();\n        args\n            .where(\n                    Predicate.or(\n                            table.firstName().ilike("a"),\n                            table.lastName().ilke("b")\n                    )\n            )\n            .orderBy(\n                    table.firstName(),\n                    table.lastName()\n            );\n    }\n}\n'})})}),(0,r.jsx)(s.A,{value:"kotlin",label:"Kotlin",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kotlin",metastring:'title="AuthorFilter"',children:'package com.yourcompany.yourpackage.strategy\n\n...omitted import statements...\n\nclass AuthorsPropFilter : KFieldFilter<Author> {\n\n    override fun KFieldFilterDsl<Author>.applyTo() {\n        where(\n            or(\n                table.firstName ilike "a",\n                table.lastName ilike "a",\n            )\n        )\n        orderBy(\n            table.firstName,\n            table.lastName\n        )\n    }\n}\n'})})})]}),"\n",(0,r.jsxs)(n.p,{children:["As you can see, this type allows us to use the full capability of the ",(0,r.jsx)(n.a,{href:"../expression",children:"Jimmer DSL"})," to implement arbitrarily complex filtering and sorting logic."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Use the above Java/Kotlin class in the DTO declaration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:'title="Book.dto"',children:"export com.yourcompany.yourproject.model.Book \n    -> package com.yourcompany.yourproject.model.dto\n\n// highlight-next-line\nimport com.yourcompany.yourpackage.strategy.AuthorsPropFilter\n\nBookDetailView {\n\n    #allScalars\n\n    // highlight-next-line\n    !filter(AuthorsPropFilter)\n    authors {\n        #allScalars\n    }\n}\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"reference-fetching-methods",children:"Reference Fetching Methods"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:'title="Book.dto"',children:"BookDetailView {\n\n    #allScalars\n\n    // highlight-next-line\n    !fetchType(JOIN_ALWASY)\n    store {\n        #allScalars\n    }\n}\n"})}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["Note: Just like object fetchers, fetch methods can only be specified for reference associations ",(0,r.jsxs)(n.em,{children:["(non-collection associations, ",(0,r.jsx)(n.code,{children:"@ManyToOne"})," or ",(0,r.jsx)(n.code,{children:"@OneToOne"}),")"]})," properties"]})}),"\n",(0,r.jsx)(n.h3,{id:"limit-recursion-depth",children:"Limit recursion depth"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:'title="Book.dto"',children:"export com.yourcompany.yourproject.model.Book \n    -> package com.yourcompany.yourproject.model.dto\n\nBookDetailView {\n\n    #allScalars\n\n    // highlight-next-line\n    !depth(2)\n    childNodes*\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"controlling-whether-each-node-is-recursive",children:"Controlling Whether Each Node is Recursive"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["First, create a new class implementing the ",(0,r.jsx)(n.code,{children:"org.babyfish.jimmer.sql.fetcher.RecursionStrategy<E>"})," interface"]}),"\n",(0,r.jsxs)(o.A,{groupId:"language",children:[(0,r.jsx)(s.A,{value:"java",label:"Java",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",metastring:'title="ChildNodesRecursionStrategy.java"',children:'package com.yourcompany.yourpackage.strategy;\n\n...omitted import statements...\n\npublic class ChildNodesRecursionStrategy implements RecursionStrategy<TreeNode> {\n\n    @Override\n    public boolean isRecursive(Args<TreeNode> args) {\n        return !args.getEntity().name().equals("Clothing");\n    }\n}\n'})})}),(0,r.jsx)(s.A,{value:"kotlin",label:"Kotlin",children:(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-kotlin",metastring:'title="ChildNodesRecursionStrategy.kt"',children:'package com.yourcompany.yourpackage.strategy\n\n...omitted import statements...\n\nclass ChildNodesRecursionStrategy : RecursionStrategy<TreeNode> {\n    override fun isRecursive(args: RecursionStrategy.Args<TreeNode>): Boolean {\n        return args.entity.name != "Clothing"\n    }\n}\n'})})})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Use the above Java/Kotlin class in the DTO declaration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",metastring:'title="Book.dto"',children:"export com.yourcompany.yourproject.model.Book \n    -> package com.yourcompany.yourproject.model.dto\n\n// highlight-next-line\nimport com.yourcompany.yourpackage.strategy.ChildNodesRecursionStrategy\n\nBookDetailView {\n\n    #allScalars\n\n    // highlight-next-line\n    !recursion(ChildNodesRecursionStrategy)\n    childNodes*\n}\n"})}),"\n"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},19365:(e,n,t)=>{t.d(n,{A:()=>o});t(96540);var i=t(34164);const r={tabItem:"tabItem_Ymn6"};var a=t(74848);function o(e){let{children:n,hidden:t,className:o}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,i.A)(r.tabItem,o),hidden:t,children:n})}},11470:(e,n,t)=>{t.d(n,{A:()=>k});var i=t(96540),r=t(34164),a=t(23104),o=t(56347),s=t(205),l=t(57485),c=t(31682),d=t(70679);function h(e){return i.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:n,children:t}=e;return(0,i.useMemo)((()=>{const e=n??function(e){return h(e).map((e=>{let{props:{value:n,label:t,attributes:i,default:r}}=e;return{value:n,label:t,attributes:i,default:r}}))}(t);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function p(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function g(e){let{queryString:n=!1,groupId:t}=e;const r=(0,o.W6)(),a=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,l.aZ)(a),(0,i.useCallback)((e=>{if(!a)return;const n=new URLSearchParams(r.location.search);n.set(a,e),r.replace({...r.location,search:n.toString()})}),[a,r])]}function m(e){const{defaultValue:n,queryString:t=!1,groupId:r}=e,a=u(e),[o,l]=(0,i.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const i=t.find((e=>e.default))??t[0];if(!i)throw new Error("Unexpected error: 0 tabValues");return i.value}({defaultValue:n,tabValues:a}))),[c,h]=g({queryString:t,groupId:r}),[m,j]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[r,a]=(0,d.Dv)(t);return[r,(0,i.useCallback)((e=>{t&&a.set(e)}),[t,a])]}({groupId:r}),x=(()=>{const e=c??m;return p({value:e,tabValues:a})?e:null})();(0,s.A)((()=>{x&&l(x)}),[x]);return{selectedValue:o,selectValue:(0,i.useCallback)((e=>{if(!p({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);l(e),h(e),j(e)}),[h,j,a]),tabValues:a}}var j=t(92303);const x={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var f=t(74848);function y(e){let{className:n,block:t,selectedValue:i,selectValue:o,tabValues:s}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,a.a_)(),d=e=>{const n=e.currentTarget,t=l.indexOf(n),r=s[t].value;r!==i&&(c(n),o(r))},h=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const t=l.indexOf(e.currentTarget)+1;n=l[t]??l[0];break}case"ArrowLeft":{const t=l.indexOf(e.currentTarget)-1;n=l[t]??l[l.length-1];break}}n?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":t},n),children:s.map((e=>{let{value:n,label:t,attributes:a}=e;return(0,f.jsx)("li",{role:"tab",tabIndex:i===n?0:-1,"aria-selected":i===n,ref:e=>l.push(e),onKeyDown:h,onClick:d,...a,className:(0,r.A)("tabs__item",x.tabItem,a?.className,{"tabs__item--active":i===n}),children:t??n},n)}))})}function b(e){let{lazy:n,children:t,selectedValue:a}=e;const o=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=o.find((e=>e.props.value===a));return e?(0,i.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:o.map(((e,n)=>(0,i.cloneElement)(e,{key:n,hidden:e.props.value!==a})))})}function v(e){const n=m(e);return(0,f.jsxs)("div",{className:(0,r.A)("tabs-container",x.tabList),children:[(0,f.jsx)(y,{...n,...e}),(0,f.jsx)(b,{...n,...e})]})}function k(e){const n=(0,j.A)();return(0,f.jsx)(v,{...e,children:h(e.children)},String(n))}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>s});var i=t(96540);const r={},a=i.createContext(r);function o(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);